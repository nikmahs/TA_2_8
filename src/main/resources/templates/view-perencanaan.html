<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Lihat Perencanaan</title>

    <object th:include="fragments/fragment :: css" th:remove="tag"></object>
    <object th:include="fragments/fragment :: js" th:remove="tag"></object>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">    
    <style>
		.footer {
		   position: fixed;
		   color: black;
		   width:100%;
		   height:50px;
		   text-align: center;
		   font-size:12px;
		   bottom: 0px;
		}
	</style>
</head>

<body>
    <nav th:replace="fragments/fragment :: navbar"></nav>
    <div class="container-fluid">
    	<br>
    	<div class="row">
    		<div class="col-md-7">
    			<h3 class="text-center">Detail Perencanaan</h3>
    			<a th:href="@{/medical-supplies/perencanaan/tambah}" class="btn btn-primary">Tambah</a>
    			<div class="card my-5" id="tablePerencanaanContent">
    				<table>
						<tr>
							<th height="60">Tanggal</th>
							<td id="tanggalPerencanaan" th:text="': ' + ${aPerencanaan.tanggal}"></td>
						</tr>
						<tr>
							<th height="60">Status</th>
							<td id="statusPerencanaan" th:text="': ' + ${aPerencanaan.status}"></td>
						</tr>
    				</table>
    				
		    		<table id="tablePerencanaan" class="display">
		    			<thead class="text-center">
		    				<th>Nama Obat/Alat</th>
		    				<th>Jumlah</th>
		    			</thead>
		    			<tbody id="itemPerencanaan" >
	    					<tr th:each="perencanaanMedSup : ${listPerencanaanMedSup}">
		    					<td th:text="${perencanaanMedSup.medicalSupplies.nama}"></td>
		    					<td th:text="${perencanaanMedSup.jumlah}" class="text-center"></td>
			    			</tr>
		    			</tbody>
					</table>
    			</div>
    			
    		</div>
    		<div class="col-md-5 text-center">
    			<h3>Daftar Perencanaan</h3>
    			<div class="card my-5">
    				<table id="tableAllPerencanaan" class="display">
	    				<thead>
	    					<th>No</th>
	    					<th>Tanggal</th>
	    					<th>Status</th>
	    				</thead>
	    				<tbody>
	    					<span th:each="perencanaan : ${listPerencanaan}">
    							<tr class="rowPerencanaan" >
	    							<td class="idPerencanaan" th:text="${perencanaan.id}"></td>
	    							<td th:text="${perencanaan.tanggal}"></td>
	    							<td th:text="${perencanaan.status}"></td>
	    						</tr>
	    					</span>
	    				</tbody>
	    			</table>
    			</div>
    		</div>
    	</div>
    	
    </div>
    <div class="footer navbar-fixed-bottom text-center">
  		<p>Sistem Informasi Farmasi &copy; Kelompok B - APAP A</p>
	</div>
</body>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
<script>
	$(document).ready( function () {
	    $('#tableAllPerencanaan').DataTable();
	    $('#tablePerencanaan').DataTable();
	} );
</script>
<script th:inline="javascript">
	$(document).ready(function(){
		$('.rowPerencanaan').click(function(){
			$.ajax({
				method : 'GET',
				url : "/medical-supplies/perencanaan/getPerencanaanById",
				data : {idPerencanaan : $(this).children("td.idPerencanaan").text()}
			}).done(function(data){
				var newTanggal = '<td id="tanggalPerencanaan">: ' + data.tanggal + '</td>';
				$('#tanggalPerencanaan').html(newTanggal);
				
				var newStatus = '<td id="statusPerencanaan">: ' + data.status + '</td>';
				$('#statusPerencanaan').html(newStatus);
				
				var itemHtml = '';
				var listMedSup = data.listPerencanaanMedicalSupplies;
				var listMedSupLen = listMedSup.length;
				
				for (var i = 0; i < listMedSupLen; i++) {
					itemHtml += '<tr id="idPerencanaan">'
								+ '<td>' + listMedSup[i].medicalSupplies.nama + '</td>'
								+ '<td class="text-center">' + listMedSup[i].jumlah + '</td>' +
								'</tr>';
				}
				
				$("#itemPerencanaan").html(itemHtml);
				
			}); 
		});
	});
</script>
</html>